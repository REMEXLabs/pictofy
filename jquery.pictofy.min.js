/*!
 * Copyright 2016 Hochschule der Medien (HdM) / Stuttgart Media University
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t){"use strict";function e(n,r){n.contents().each(function(n,o){var s=t(o);if(3===s.context.nodeType){var a=s.text(),i=a.split(/([^a-zA-Z\x7f-\xff])/),c=i.map(function(t){return/[a-zA-Z\x7f-\xff]+/.test(t)?'<span class="'+r["class"]+'">'+t+"</span>":t});s.replaceWith(c.join(""))}else e(s.not("."+r["class"]),r)})}function n(e,n,s){o(e,s).done(function(o,a){var i=n.tooltipster("content");t(i).append(r(e,o.rating,s))}).fail(function(t,e,n){console.log(e),console.log(n)})}function r(e,n,r){for(var o=t("<div>").addClass("picto-stars").append(),s=function(n){return function(){o.text("Thanks."),t.ajax({url:r.getRatingUrl(e),method:"POST",data:{rating:n},crossDomain:!0,xhrFields:{withCredentials:!0}})}},a=1;a<=5;a++){var i=t("<span>").addClass("picto-stars__star").toggleClass("picto-stars__star--empty",a>n);i.click(s(a)),o.append(i)}return o}function o(e,n){return t.ajax({url:n.getRatingUrl(e),crossDomain:!0,xhrFields:{withCredentials:!0}})}function s(e){var n={};return t("."+e["class"]).each(function(e,r){var o=r.innerHTML.toLowerCase().trim();o in n||(n[o]=[]),n[o].push(t(r))}),n}t.fn.pictofy=function(r){var o=t.extend({},t.fn.pictofy.defaults,r);e(this,o);var a=s(o),i=t.res(o.resUrl);return Object.keys(a).forEach(function(e){var r=void 0===typeof AS_picsupport?o.lang:AS_picsupport.language||o.lang;i.queries().addQuery().addProp("http://openurc.org/ns/res#type","http://openurc.org/restypes#pictogram").addPropWithDescs("http://purl.org/dc/elements/1.1/title",e).addDesc("lang",r).complete().complete().send().done(function(r){if(r.firstResponse().numberOfResources()>0){var s=r.getVeryFirstGlobalAt();s=s.replace("http://","//");var i=r.firstResponse().firstResource().props.find(function(t){return"http://openurc.org/ns/res#name"===t.name}).value;a[e].forEach(function(e){t(e).attr("data-picto-src",s),t(e).attr("data-picto-name",i),t(e).tooltipster({updateAnimation:null,trigger:o.trigger,theme:"tooltipster-picto",onlyOne:!0,interactive:!0,content:o.preContent,functionReady:function(e){var r=t("<div>").addClass("picto-container");return r.append(t("<img>").attr("src",s)),e.tooltipster("content",r),n(i,e,o),!0}})})}}).fail(function(t){console.log(t.error),console.log(t.status)})}),this},t.fn.pictofy.destroy=function(e){var n=t.extend({},t.fn.pictofy.defaults,e);t("."+n["class"]+"[data-picto-src]").tooltipster("destroy"),t("."+n["class"]).each(function(e,n){t(n).replaceWith(t(n).html())})},t.fn.pictofy.defaults={resUrl:"https://res.openurc.org/",getRatingUrl:function(t){return"https://picsupport.gpii.eu/rating/"+encodeURIComponent(t)},lang:"en","class":"picto-tooltip",preContent:t('<div style="height:200px;width:200px;">&nbsp;</div>'),trigger:"click"}}(jQuery);